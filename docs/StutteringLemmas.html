<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory StutteringLemmas (Isabelle2017: October 2017)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory StutteringLemmas</h1>

<span class="command">theory</span> <span class="name">StutteringLemmas</span><br/>
<span class="keyword">imports</span> <a href="StutteringDefs.html"><span class="name">StutteringDefs</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">theory</span></span><span class=""> </span><span class="">StutteringLemmas</span><span class="">
</span><span class="">
</span><span class="keyword2"><span class="keyword">imports</span></span><span class=""> </span><span class="">StutteringDefs</span><span class="">
</span><span class="">
</span><span class="keyword2"><span class="keyword">begin</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="verbatim">{* Lemmas used to prove the invariance by stuttering *}</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  A dilating function is injective.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dilating_fun_injects</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating_fun f r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;inj_on f A&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_mono_imp_inj_on</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  If a clock ticks at an instant in a dilated run, that instant is the image
  by the dilating function of an instant of the original run.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ticks_image</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating_fun f r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">     </span><span class="string">&quot;hamlet ((Rep_run r) n c)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;&#8707;n<span class="hidden">&#8681;</span><sub>0</sub>. f n<span class="hidden">&#8681;</span><sub>0</sub> = n&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  The image of the ticks in a interval by a dilating function is the interval 
  bounded by the image of the bound of the original interval.
  This is proven for all 4 kinds of intervals: ]m, n[, [m, n[, ]m, n] and [m, n].
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dilating_fun_image_strict</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating_fun f r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{k. f m &lt; k &#8743; k &lt; f n &#8743; hamlet ((Rep_run r) k c)}
            = image f {k. m &lt; k &#8743; k &lt; n &#8743; hamlet ((Rep_run r) (f k) c)}&quot;</span><span class="">
</span><span class="">  </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;?IMG = image f ?SET&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;k &#8712; ?IMG&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">k0prop</span><span class="delimiter">:</span><span class="string">&quot;f k<span class="hidden">&#8681;</span><sub>0</sub> = k &#8743; hamlet ((Rep_run r) (f k<span class="hidden">&#8681;</span><sub>0</sub>) c)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">ticks_image</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;k &#8712; image f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_mono_less</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;?IMG &#8838; image f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;k &#8712; image f ?SET&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">k0prop</span><span class="delimiter">:</span><span class="string">&quot;k = f k<span class="hidden">&#8681;</span><sub>0</sub> &#8743; k<span class="hidden">&#8681;</span><sub>0</sub> &#8712; ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;k &#8712; ?IMG&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_mono_less</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;image f ?SET &#8838; ?IMG&quot;</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dilating_fun_image_left</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating_fun f r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{k. f m &#8804; k &#8743; k &lt; f n &#8743; hamlet ((Rep_run r) k c)}
          = image f {k. m &#8804; k &#8743; k &lt; n &#8743; hamlet ((Rep_run r) (f k) c)}&quot;</span><span class="">
</span><span class="">  </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;?IMG = image f ?SET&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;k &#8712; ?IMG&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">k0prop</span><span class="delimiter">:</span><span class="string">&quot;f k<span class="hidden">&#8681;</span><sub>0</sub> = k &#8743; hamlet ((Rep_run r) (f k<span class="hidden">&#8681;</span><sub>0</sub>) c)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">ticks_image</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;k &#8712; image f ?SET&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_mono_less</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;?IMG &#8838; image f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;k &#8712; image f ?SET&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">k0prop</span><span class="delimiter">:</span><span class="string">&quot;k = f k<span class="hidden">&#8681;</span><sub>0</sub> &#8743; k<span class="hidden">&#8681;</span><sub>0</sub> &#8712; ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;k &#8712; ?IMG&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_mono_less</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;image f ?SET &#8838; ?IMG&quot;</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dilating_fun_image_right</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating_fun f r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{k. f m &lt; k &#8743; k &#8804; f n &#8743; hamlet ((Rep_run r) k c)}
          = image f {k. m &lt; k &#8743; k &#8804; n &#8743; hamlet ((Rep_run r) (f k) c)}&quot;</span><span class="">
</span><span class="">  </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;?IMG = image f ?SET&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;k &#8712; ?IMG&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">k0prop</span><span class="delimiter">:</span><span class="string">&quot;f k<span class="hidden">&#8681;</span><sub>0</sub> = k &#8743; hamlet ((Rep_run r) (f k<span class="hidden">&#8681;</span><sub>0</sub>) c)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">ticks_image</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;k &#8712; image f ?SET&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_mono_less</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;?IMG &#8838; image f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;k &#8712; image f ?SET&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">k0prop</span><span class="delimiter">:</span><span class="string">&quot;k = f k<span class="hidden">&#8681;</span><sub>0</sub> &#8743; k<span class="hidden">&#8681;</span><sub>0</sub> &#8712; ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;k &#8712; ?IMG&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_mono_less</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;image f ?SET &#8838; ?IMG&quot;</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dilating_fun_image</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating_fun f r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{k. f m &#8804; k &#8743; k &#8804; f n &#8743; hamlet ((Rep_run r) k c)}
          = image f {k. m &#8804; k &#8743; k &#8804; n &#8743; hamlet ((Rep_run r) (f k) c)}&quot;</span><span class="">
</span><span class="">  </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;?IMG = image f ?SET&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;k &#8712; ?IMG&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">k0prop</span><span class="delimiter">:</span><span class="string">&quot;f k<span class="hidden">&#8681;</span><sub>0</sub> = k &#8743; hamlet ((Rep_run r) (f k<span class="hidden">&#8681;</span><sub>0</sub>) c)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">ticks_image</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;k &#8712; image f ?SET&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;?IMG &#8838; image f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;k &#8712; image f ?SET&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">k0prop</span><span class="delimiter">:</span><span class="string">&quot;k = f k<span class="hidden">&#8681;</span><sub>0</sub> &#8743; k<span class="hidden">&#8681;</span><sub>0</sub> &#8712; ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;k &#8712; ?IMG&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;image f ?SET &#8838; ?IMG&quot;</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  On any clock, the number of ticks in an interval is preserved
  by a dilating function.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ticks_as_often_strict</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating_fun f r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;card {p. n &lt; p &#8743; p &lt; m &#8743; hamlet ((Rep_run r) (f p) c)}
          = card {p. f n &lt; p &#8743; p &lt; f m &#8743; hamlet ((Rep_run r) p c)}&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;card ?SET = card ?IMG&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">dilating_fun_injects</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;inj_on f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;finite ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">inj_on_iff_eq_card</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;card (image f ?SET) = card ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">dilating_fun_image_strict</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?IMG = image f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ticks_as_often_left</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating_fun f r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;card {p. n &#8804; p &#8743; p &lt; m &#8743; hamlet ((Rep_run r) (f p) c)}
          = card {p. f n &#8804; p &#8743; p &lt; f m &#8743; hamlet ((Rep_run r) p c)}&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;card ?SET = card ?IMG&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">dilating_fun_injects</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;inj_on f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;finite ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">inj_on_iff_eq_card</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;card (image f ?SET) = card ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">dilating_fun_image_left</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?IMG = image f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ticks_as_often_right</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating_fun f r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;card {p. n &lt; p &#8743; p &#8804; m &#8743; hamlet ((Rep_run r) (f p) c)}
          = card {p. f n &lt; p &#8743; p &#8804; f m &#8743; hamlet ((Rep_run r) p c)}&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;card ?SET = card ?IMG&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">dilating_fun_injects</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;inj_on f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;finite ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">inj_on_iff_eq_card</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;card (image f ?SET) = card ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">dilating_fun_image_right</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?IMG = image f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ticks_as_often</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating_fun f r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;card {p. n &#8804; p &#8743; p &#8804; m &#8743; hamlet ((Rep_run r) (f p) c)}
          = card {p. f n &#8804; p &#8743; p &#8804; f m &#8743; hamlet ((Rep_run r) p c)}&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;card ?SET = card ?IMG&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">dilating_fun_injects</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;inj_on f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;finite ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">inj_on_iff_eq_card</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;card (image f ?SET) = card ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">dilating_fun_image</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?IMG = image f ?SET&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dilating_injects</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;inj_on f A&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_mono_imp_inj_on</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  If there is a tick at instant n in a dilated run, n is necessarily the image
  of some instant in the subrun.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ticks_image_sub</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">     </span><span class="string">&quot;hamlet ((Rep_run r) n c)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;&#8707;n<span class="hidden">&#8681;</span><sub>0</sub>. f n<span class="hidden">&#8681;</span><sub>0</sub> = n&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">ticks_image</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ticks_image_sub&#39;</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">     </span><span class="string">&quot;&#8707;c. hamlet ((Rep_run r) n c)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;&#8707;n<span class="hidden">&#8681;</span><sub>0</sub>. f n<span class="hidden">&#8681;</span><sub>0</sub> = n&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  Time is preserved by dilation when ticks occur.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ticks_tag_image</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">     </span><span class="string">&quot;&#8707;c. hamlet ((Rep_run r) k c)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">     </span><span class="string">&quot;time ((Rep_run r) k c) = &#964;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;&#8707;k<span class="hidden">&#8681;</span><sub>0</sub>. f k<span class="hidden">&#8681;</span><sub>0</sub> = k &#8743; time ((Rep_run sub) k<span class="hidden">&#8681;</span><sub>0</sub> c) = &#964;&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">ticks_image_sub&#39;</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">,</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k<span class="hidden">&#8681;</span><sub>0</sub>. f k<span class="hidden">&#8681;</span><sub>0</sub> = k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">this</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;f k<span class="hidden">&#8681;</span><sub>0</sub> = k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">,</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;time ((Rep_run sub) k<span class="hidden">&#8681;</span><sub>0</sub> c) = &#964;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  TESL operators are preserved by dilation.
*}</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ticks_sub</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;hamlet ((Rep_run sub) n a) = hamlet ((Rep_run r) (f n) a)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">no_tick_sub</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;(&#8708;n<span class="hidden">&#8681;</span><sub>0</sub>. f n<span class="hidden">&#8681;</span><sub>0</sub> = n) &#10230; &#172;hamlet ((Rep_run r) n a)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  Lifting a total function to a partial function on an option domain.
*}</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">opt_lift</span><span class="delimiter">::</span><span class="string">&quot;(&#39;a &#8658; &#39;a) &#8658; (&#39;a option &#8658; &#39;a option)&quot;</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;opt_lift f &#8801; &#955;x. case x of None &#8658; None | Some y &#8658; Some (f y)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  The set of instants when a clock ticks in a dilated run is the image by the dilation function
  of the set of instants when it ticks in the subrun.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tick_set_sub</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{k. hamlet ((Rep_run r) k c)} = image f {k. hamlet ((Rep_run sub) k c)}&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;?R = image f ?S&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;k &#8712; ?R&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">no_tick_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k<span class="hidden">&#8681;</span><sub>0</sub>. f k<span class="hidden">&#8681;</span><sub>0</sub> = k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">this</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">k0prop</span><span class="delimiter">:</span><span class="string">&quot;f k<span class="hidden">&#8681;</span><sub>0</sub> = k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">ticks_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run sub) k<span class="hidden">&#8681;</span><sub>0</sub> c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">k0prop</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;k &#8712; image f ?S&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;?R &#8838; image f ?S&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;k &#8712; image f ?S&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">this</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;f k<span class="hidden">&#8681;</span><sub>0</sub> = k &#8743; hamlet ((Rep_run sub) k<span class="hidden">&#8681;</span><sub>0</sub> c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;k &#8712; ?R&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">ticks_sub</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;image f ?S &#8838; ?R&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  Strictly monotonous functions preserve the least element.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Least_strict_mono</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;strict_mono f&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">     </span><span class="string">&quot;&#8707;x &#8712; S. &#8704;y &#8712; S. x &#8804; y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;(LEAST y. y &#8712; f ` S) = f (LEAST x. x &#8712; S)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Least_mono</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">strict_mono_mono</span><span class="delimiter">,</span><span class=""> </span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  A non empty set of nats has a least element.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Least_nat_ex</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;(n::nat) &#8712; S &#10233; &#8707;x &#8712; S. (&#8704;y &#8712; S. x &#8804; y)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induction</span><span class=""> </span><span class="">n</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">nat_less_induct</span><span class="delimiter">,</span><span class=""> </span><span class="">insert</span><span class=""> </span><span class="">not_le_imp_less</span><span class="delimiter">,</span><span class=""> </span><span class="">blast</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  The first instant when a clock ticks in a dilated run is the image by the dilation
  function of the first instant when it ticks in the subrun.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Least_sub</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">     </span><span class="string">&quot;&#8707;k::nat. hamlet ((Rep_run sub) k c)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;(LEAST k. k &#8712; {t. hamlet ((Rep_run r) t c)}) = f (LEAST k. k &#8712; {t. hamlet ((Rep_run sub) t c)})&quot;</span><span class="">
</span><span class="">          </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;(LEAST k. k &#8712; ?R) = f (LEAST k. k &#8712; ?S)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;x. x &#8712; ?S&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="">least</span><span class="delimiter">:</span><span class="string">&quot;&#8707;x &#8712; ?S. &#8704;y &#8712; ?S. x &#8804; y&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Least_nat_ex</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;strict_mono f&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">Least_strict_mono</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">this</span><span class=""> </span><span class="">least</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class="">
</span><span class="">    </span><span class="string">&quot;(LEAST y. y &#8712; f ` ?S)  = f (LEAST x. x &#8712; ?S)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">tick_set_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  If a clock ticks in a run, it ticks in the subrun.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ticks_imp_ticks_sub</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">     </span><span class="string">&quot;&#8707;k. hamlet ((Rep_run r) k c)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;&#8707;k<span class="hidden">&#8681;</span><sub>0</sub>. hamlet ((Rep_run sub) k<span class="hidden">&#8681;</span><sub>0</sub> c)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run r) k c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">ticks_image_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class=""> </span><span class="">ticks_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  Stronger version: it ticks in the subrun and we know when.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ticks_imp_ticks_subk</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">     </span><span class="string">&quot;hamlet ((Rep_run r) k c)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;&#8707;k<span class="hidden">&#8681;</span><sub>0</sub>. f k<span class="hidden">&#8681;</span><sub>0</sub> = k &#8743; hamlet ((Rep_run sub) k<span class="hidden">&#8681;</span><sub>0</sub> c)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">no_tick_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k<span class="hidden">&#8681;</span><sub>0</sub>. f k<span class="hidden">&#8681;</span><sub>0</sub> = k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">this</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;f k<span class="hidden">&#8681;</span><sub>0</sub> = k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">ticks_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run sub) k<span class="hidden">&#8681;</span><sub>0</sub> c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  A dilating function preserves the tick count on an interval for any clock.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dilated_ticks_strict</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{i. f m &lt; i &#8743; i &lt; f n &#8743; hamlet ((Rep_run r) i c)}
          = image f {i. m &lt; i &#8743; i &lt; n &#8743; hamlet ((Rep_run sub) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;?RUN = image f ?SUB&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;i &#8712; ?SUB&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;m &lt; i &#8743; i &lt; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;f m &lt; f i &#8743; f i &lt; (f n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_monoD</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run sub) i c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run r) (f i) c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">ticks_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f i &#8712; ?RUN&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;image f ?SUB &#8838; ?RUN&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;i &#8712; ?RUN&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run r) i c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">ticks_imp_ticks_subk</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">i<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">i0prop</span><span class="delimiter">:</span><span class="string">&quot;f i<span class="hidden">&#8681;</span><sub>0</sub> = i &#8743; hamlet ((Rep_run sub) i<span class="hidden">&#8681;</span><sub>0</sub> c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f m &lt; f i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; f i<span class="hidden">&#8681;</span><sub>0</sub> &lt; f n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;strict_mono f&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m &lt; i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; i<span class="hidden">&#8681;</span><sub>0</sub> &lt; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">strict_mono_less</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">i0prop</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i<span class="hidden">&#8681;</span><sub>0</sub>. f i<span class="hidden">&#8681;</span><sub>0</sub> = i &#8743; i<span class="hidden">&#8681;</span><sub>0</sub> &#8712; ?SUB&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;?RUN &#8838; image f ?SUB&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dilated_ticks_left</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{i. f m &#8804; i &#8743; i &lt; f n &#8743; hamlet ((Rep_run r) i c)}
          = image f {i. m &#8804; i &#8743; i &lt; n &#8743; hamlet ((Rep_run sub) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;?RUN = image f ?SUB&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;i &#8712; ?SUB&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;m &#8804; i &#8743; i &lt; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;f m &#8804; f i &#8743; f i &lt; (f n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_monoD</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run sub) i c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run r) (f i) c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">ticks_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f i &#8712; ?RUN&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;image f ?SUB &#8838; ?RUN&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;i &#8712; ?RUN&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run r) i c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">ticks_imp_ticks_subk</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">i<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">i0prop</span><span class="delimiter">:</span><span class="string">&quot;f i<span class="hidden">&#8681;</span><sub>0</sub> = i &#8743; hamlet ((Rep_run sub) i<span class="hidden">&#8681;</span><sub>0</sub> c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f m &#8804; f i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; f i<span class="hidden">&#8681;</span><sub>0</sub> &lt; f n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;strict_mono f&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m &#8804; i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; i<span class="hidden">&#8681;</span><sub>0</sub> &lt; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">strict_mono_less</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">i0prop</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i<span class="hidden">&#8681;</span><sub>0</sub>. f i<span class="hidden">&#8681;</span><sub>0</sub> = i &#8743; i<span class="hidden">&#8681;</span><sub>0</sub> &#8712; ?SUB&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;?RUN &#8838; image f ?SUB&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dilated_ticks_right</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{i. f m &lt; i &#8743; i &#8804; f n &#8743; hamlet ((Rep_run r) i c)}
          = image f {i. m &lt; i &#8743; i &#8804; n &#8743; hamlet ((Rep_run sub) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;?RUN = image f ?SUB&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;i &#8712; ?SUB&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;m &lt; i &#8743; i &#8804; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;f m &lt; f i &#8743; f i &#8804; (f n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_monoD</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run sub) i c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run r) (f i) c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">ticks_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f i &#8712; ?RUN&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;image f ?SUB &#8838; ?RUN&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;i &#8712; ?RUN&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run r) i c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">ticks_imp_ticks_subk</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">i<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">i0prop</span><span class="delimiter">:</span><span class="string">&quot;f i<span class="hidden">&#8681;</span><sub>0</sub> = i &#8743; hamlet ((Rep_run sub) i<span class="hidden">&#8681;</span><sub>0</sub> c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f m &lt; f i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; f i<span class="hidden">&#8681;</span><sub>0</sub> &#8804; f n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;strict_mono f&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m &lt; i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; i<span class="hidden">&#8681;</span><sub>0</sub> &#8804; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">strict_mono_less</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">i0prop</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i<span class="hidden">&#8681;</span><sub>0</sub>. f i<span class="hidden">&#8681;</span><sub>0</sub> = i &#8743; i<span class="hidden">&#8681;</span><sub>0</sub> &#8712; ?SUB&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;?RUN &#8838; image f ?SUB&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dilated_ticks</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{i. f m &#8804; i &#8743; i &#8804; f n &#8743; hamlet ((Rep_run r) i c)}
          = image f {i. m &#8804; i &#8743; i &#8804; n &#8743; hamlet ((Rep_run sub) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;?RUN = image f ?SUB&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;i &#8712; ?SUB&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;m &#8804; i &#8743; i &#8804; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;f m &#8804; f i &#8743; f i &#8804; (f n)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">strict_mono_less_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run sub) i c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run r) (f i) c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">ticks_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f i &#8712;?RUN&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;image f ?SUB &#8838; ?RUN&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class=""> </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;i &#8712; ?RUN&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run r) i c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">ticks_imp_ticks_subk</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">i<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">i0prop</span><span class="delimiter">:</span><span class="string">&quot;f i<span class="hidden">&#8681;</span><sub>0</sub> = i &#8743; hamlet ((Rep_run sub) i<span class="hidden">&#8681;</span><sub>0</sub> c)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f m &#8804; f i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; f i<span class="hidden">&#8681;</span><sub>0</sub> &#8804; f n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;strict_mono f&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m &#8804; i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; i<span class="hidden">&#8681;</span><sub>0</sub> &#8804; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">strict_mono_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">i0prop</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i<span class="hidden">&#8681;</span><sub>0</sub>. f i<span class="hidden">&#8681;</span><sub>0</sub> = i &#8743; i<span class="hidden">&#8681;</span><sub>0</sub> &#8712; ?SUB&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;?RUN &#8838; image f ?SUB&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  No tick can occur in a dilated run before the image of 0 by the dilation function.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">empty_dilated_prefix</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">     </span><span class="string">&quot;n &lt; f 0&quot;</span><span class="">
</span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;&#172; hamlet ((Rep_run r) n c)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class=""> </span><span class="comment">(* This one is easy with the new definition of a dilating function. *)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">False</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">corollary</span></span><span class=""> </span><span class="">empty_dilated_prefix&#39;</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{i. f 0 &#8804; i &#8743; i &#8804; f n &#8743; hamlet ((Rep_run r) i c)} = {i. i &#8804; f n &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;strict_mono f&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;f 0 &#8804; f n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">strict_mono_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">less_mono_imp_le_mono</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &#8804; f n = (i &lt; f 0) &#8744; (f 0 &#8804; i &#8743; i &#8804; f n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;{i. i &#8804; f n &#8743; hamlet ((Rep_run r) i c)}
        = {i. i &lt; f 0 &#8743; hamlet ((Rep_run r) i c)} &#8746; {i. f 0 &#8804; i &#8743; i &#8804; f n &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = {i. f 0 &#8804; i &#8743; i &#8804; f n &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">empty_dilated_prefix</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">finally</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">corollary</span></span><span class=""> </span><span class="">dilated_prefix</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{i. i &#8804; f n &#8743; hamlet ((Rep_run r) i c)}
          = image f {i. i &#8804; n &#8743; hamlet ((Rep_run sub) i c)}&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;{i. 0 &#8804; i &#8743; i &#8804; f n &#8743; hamlet ((Rep_run r) i c)}
        = image f {i. 0 &#8804; i &#8743; i &#8804; n &#8743; hamlet ((Rep_run sub) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">dilated_ticks</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="">empty_dilated_prefix&#39;</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">corollary</span></span><span class=""> </span><span class="">dilated_strict_prefix</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="">   </span><span class="string">&quot;{i. i &lt; f n &#8743; hamlet ((Rep_run r) i c)}
          = image f {i. i &lt; n &#8743; hamlet ((Rep_run sub) i c)}&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;dilating_fun f r&quot;</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">dilating_fun_image_left</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">this</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="string">&quot;0&quot;</span><span class=""> </span><span class="string">&quot;n&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;{i. f 0 &#8804; i &#8743; i &lt; f n &#8743; hamlet ((Rep_run r) i c)}
        = image f {i. 0 &#8804; i &#8743; i &lt; n &#8743; hamlet ((Rep_run r) (f i) c)}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = image f {i. 0 &#8804; i &#8743; i &lt; n &#8743; hamlet ((Rep_run sub) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">finally</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Collect_cong</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">empty_dilated_prefix</span><span class=""> </span><span class="">le0</span><span class=""> </span><span class="">not_le_imp_less</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  A singleton of nat can be defined with a weaker property.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">nat_sing_prop</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;{i::nat. i = k &#8743; P(i)} = {i::nat. i = k &#8743; P(k)}&quot;</span><span class="">
</span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  The set definition and the function definition of tick_count are equivalent.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tick_count_is_fun</span><span class="delimiter">[</span><span class="">code</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="string">&quot;tick_count r c n = run_tick_count r c n&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induction</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count r c 0 = card {i. i &#8804; 0 &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">tick_count_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = card {i::nat. i = 0 &#8743; hamlet ((Rep_run r) 0 c)}&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">le_zero_eq</span><span class=""> </span><span class="">nat_sing_prop</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;0&quot;</span><span class=""> </span><span class="string">&quot;&#955;i. hamlet ((Rep_run r) i c)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = (if hamlet ((Rep_run r) 0 c) then 1 else 0)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = run_tick_count r c 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">finally</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">k</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;hamlet ((Rep_run r) (Suc k) c)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">True</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;{i. i &#8804; Suc k &#8743; hamlet ((Rep_run r) i c)} = insert (Suc k) {i. i &#8804; k &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;tick_count r c (Suc k) = Suc (tick_count r c k)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">tick_count_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">Suc.IH</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count r c (Suc k) = Suc (run_tick_count r c k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">True</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">False</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;{i. i &#8804; Suc k &#8743; hamlet ((Rep_run r) i c)} = {i. i &#8804; k &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">le_Suc_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;tick_count r c (Suc k) = tick_count r c k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">tick_count_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc.IH</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">False</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">text</span></span><span class=""> </span><span class="verbatim">{*
  The set definition and the function definition of tick_count_strict are equivalent.
*}</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tick_count_strict_suc</span><span class="delimiter">:</span><span class="string">&quot;tick_count_strict r c (Suc n) = tick_count r c n&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">tick_count_def</span><span class=""> </span><span class="">tick_count_strict_def</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">less_Suc_eq_le</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tick_count_strict_is_fun</span><span class="delimiter">[</span><span class="">code</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="string">&quot;tick_count_strict r c n = run_tick_count_strictly r c n&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;n = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">True</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;tick_count_strict r c n = 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">tick_count_strict_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = run_tick_count_strictly r c 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">run_tick_count_strictly.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">finally</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">True</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">False</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">not0_implies_Suc</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class="string">&quot;n = Suc m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;tick_count_strict r c n = tick_count r c m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_strict_suc</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = run_tick_count r c m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_is_fun</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class=""> </span><span class="string">&quot;m&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = run_tick_count_strictly r c (Suc m)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">run_tick_count_strictly.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">finally</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">strictly_precedes_alt_def1</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;{ &#961;. &#8704;n::nat. (run_tick_count &#961; K<span class="hidden">&#8681;</span><sub>2</sub> n) &#8804; (run_tick_count_strictly &#961; K<span class="hidden">&#8681;</span><sub>1</sub> n) }
 = { &#961;. &#8704;n::nat. (run_tick_count_strictly &#961; K<span class="hidden">&#8681;</span><sub>2</sub> (Suc n)) &#8804; (run_tick_count_strictly &#961; K<span class="hidden">&#8681;</span><sub>1</sub> n) }&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_is_fun</span><span class=""> </span><span class="">tick_count_strict_suc</span><span class=""> </span><span class="">tick_count_strict_is_fun</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">strictly_precedes_alt_def2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;{ &#961;. &#8704;n::nat. (run_tick_count &#961; K<span class="hidden">&#8681;</span><sub>2</sub> n) &#8804; (run_tick_count_strictly &#961; K<span class="hidden">&#8681;</span><sub>1</sub> n) }
 = { &#961;. (&#172;hamlet ((Rep_run &#961;) 0 K<span class="hidden">&#8681;</span><sub>2</sub>)) &#8743; (&#8704;n::nat. (run_tick_count &#961; K<span class="hidden">&#8681;</span><sub>2</sub> (Suc n)) &#8804; (run_tick_count &#961; K<span class="hidden">&#8681;</span><sub>1</sub> n)) }&quot;</span><span class="">
</span><span class="">  </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span class=""> </span><span class="string">&quot;?P = ?P&#39;&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">r</span><span class="delimiter">::</span><span class="string">&quot;&#39;a run&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;r &#8712; ?P&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;&#8704;n::nat. (run_tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> n) &#8804; (run_tick_count_strictly r K<span class="hidden">&#8681;</span><sub>1</sub> n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class="string">&quot;&#8704;n::nat. (tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> n) &#8804; (tick_count_strict r K<span class="hidden">&#8681;</span><sub>1</sub> n)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_is_fun</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="">r</span><span class="delimiter">]</span><span class=""> </span><span class="">tick_count_strict_is_fun</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="">r</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;&#8704;n::nat. (tick_count_strict r K<span class="hidden">&#8681;</span><sub>2</sub> (Suc n)) &#8804; (tick_count_strict r K<span class="hidden">&#8681;</span><sub>1</sub> n)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_strict_suc</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class=""> </span><span class="string">&quot;K<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;&#8704;n::nat. (tick_count_strict r K<span class="hidden">&#8681;</span><sub>2</sub> (Suc (Suc n))) &#8804; (tick_count_strict r K<span class="hidden">&#8681;</span><sub>1</sub> (Suc n))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;&#8704;n::nat. (tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> (Suc n)) &#8804; (tick_count r K<span class="hidden">&#8681;</span><sub>1</sub> n)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_strict_suc</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class="string">&quot;&#8704;n::nat. (run_tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> (Suc n)) &#8804; (run_tick_count r K<span class="hidden">&#8681;</span><sub>1</sub> n)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">tick_count_is_fun</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count_strict r K<span class="hidden">&#8681;</span><sub>1</sub> 0 = 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">tick_count_strict_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> 0 = 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">le_zero_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;&#172;hamlet ((Rep_run r) 0 K<span class="hidden">&#8681;</span><sub>2</sub>)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">tick_count_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;r &#8712; ?P&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;?P &#8838; ?P&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">r</span><span class="delimiter">::</span><span class="string">&quot;&#39;a run&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h</span><span class="delimiter">:</span><span class="string">&quot;r &#8712; ?P&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;&#8704;n::nat. (run_tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> (Suc n)) &#8804; (run_tick_count r K<span class="hidden">&#8681;</span><sub>1</sub> n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;&#8704;n::nat. (tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> (Suc n)) &#8804; (tick_count r K<span class="hidden">&#8681;</span><sub>1</sub> n)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_is_fun</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;&#8704;n::nat. (tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> (Suc n)) &#8804; (tick_count_strict r K<span class="hidden">&#8681;</span><sub>1</sub> (Suc n))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_strict_suc</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class=""> </span><span class="string">&quot;K<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class="string">&quot;&#8704;n. n &gt; 0 &#10230; (tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> n) &#8804; (tick_count_strict r K<span class="hidden">&#8681;</span><sub>1</sub> n)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gr0_implies_Suc</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count_strict r K<span class="hidden">&#8681;</span><sub>1</sub> 0 = 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">tick_count_strict_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">h</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;hamlet ((Rep_run r) 0 K<span class="hidden">&#8681;</span><sub>2</sub>)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> 0 = 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">tick_count_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> 0 &#8804; tick_count_strict r K<span class="hidden">&#8681;</span><sub>1</sub> 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;n. (tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> n) &#8804; (tick_count_strict r K<span class="hidden">&#8681;</span><sub>1</sub> n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">gr0I</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;&#8704;n. (run_tick_count r K<span class="hidden">&#8681;</span><sub>2</sub> n) &#8804; (run_tick_count_strictly r K<span class="hidden">&#8681;</span><sub>1</sub> n)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_is_fun</span><span class=""> </span><span class="">tick_count_strict_is_fun</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;r &#8712; ?P&quot;</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;?P&#39; &#8838; ?P&quot;</span><span class=""> </span><span class="keyword1"><span class="command">..</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">run_tick_count_suc</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;run_tick_count r c (Suc n) = (if hamlet ((Rep_run r) (Suc n) c)
                                 then Suc (run_tick_count r c n)
                                 else run_tick_count r c n)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">corollary</span></span><span class=""> </span><span class="">tick_count_suc</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;tick_count r c (Suc n) = (if hamlet ((Rep_run r) (Suc n) c)
                             then Suc (tick_count r c n)
                             else tick_count r c n)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">tick_count_is_fun</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">card_suc</span><span class="delimiter">:</span><span class="string">&quot;card {i. i &#8804; (Suc n) &#8743; P i} = card {i. i &#8804; n &#8743; P i} + card {i. i = (Suc n) &#8743; P i}&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;{i. i &#8804; n &#8743; P i} &#8745; {i. i = (Suc n) &#8743; P i} = {}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;{i. i &#8804; n &#8743; P i} &#8746; {i. i = (Suc n) &#8743; P i} = {i. i &#8804; (Suc n) &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;finite {i. i &#8804; n &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;finite {i. i = (Suc n) &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">card_Un_disjoint</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;{i. i &#8804; n &#8743; P i}&quot;</span><span class=""> </span><span class="string">&quot;{i. i = Suc n &#8743; P i}&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">card_le_leq</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;m &lt; n&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;card {i::nat. m &lt; i &#8743; i &#8804; n &#8743; P i} = card {i. m &lt; i &#8743; i &lt; n &#8743; P i} + card {i. i = n &#8743; P i}&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;{i::nat. m &lt; i &#8743; i &lt; n &#8743; P i} &#8745; {i. i = n &#8743; P i} = {}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;{i::nat. m &lt; i &#8743; i &lt; n &#8743; P i} &#8746; {i. i = n &#8743; P i} = {i. m &lt; i &#8743; i &#8804; n &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;finite {i. m &lt; i &#8743; i &lt; n &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;finite {i. i = n &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">card_Un_disjoint</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;{i. m &lt; i &#8743; i &lt; n &#8743; P i}&quot;</span><span class=""> </span><span class="string">&quot;{i. i = n &#8743; P i}&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">card_le_leq_0</span><span class="delimiter">:</span><span class="string">&quot;card {i::nat. i &#8804; n &#8743; P i} = card {i. i &lt; n &#8743; P i} + card {i. i = n &#8743; P i}&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;{i::nat. i &lt; n &#8743; P i} &#8745; {i. i = n &#8743; P i} = {}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;{i. i &lt; n &#8743; P i} &#8746; {i. i = n &#8743; P i} = {i. i &#8804; n &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;finite {i. i &lt; n &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;finite {i. i = n &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">card_Un_disjoint</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;{i. i &lt; n &#8743; P i}&quot;</span><span class=""> </span><span class="string">&quot;{i. i = n &#8743; P i}&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">card_mnm</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;m &lt; n&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;card {i::nat. i &lt; n &#8743; P i} = card {i. i &#8804; m &#8743; P i} + card {i. m &lt; i &#8743; i &lt; n &#8743; P i}&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class="string">&quot;{i::nat. i &#8804; m &#8743; P i} &#8745; {i. m &lt; i &#8743; i &lt; n &#8743; P i} = {}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i::nat. i &lt; n = (i &#8804; m) &#8744; (m &lt; i &#8743; i &lt; n)&quot;</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">less_trans</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;{i::nat. i &lt; n &#8743; P i} = {i. i &#8804; m &#8743; P i} &#8746; {i. m &lt; i &#8743; i &lt; n &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class="string">&quot;finite {i. i &#8804; m &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">4</span><span class="delimiter">:</span><span class="string">&quot;finite {i. m &lt; i &#8743; i &lt; n &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">card_Un_disjoint</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">3</span><span class=""> </span><span class="">4</span><span class=""> </span><span class="">1</span><span class="delimiter">]</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">nat_interval_union</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;m &#8804; n&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;{i::nat. i &#8804; n &#8743; P i} = {i::nat. i &#8804; m &#8743; P i} &#8746; {i::nat. m &lt; i &#8743; i &#8804; n &#8743; P i}&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">le_cases</span><span class=""> </span><span class="">nat_less_le</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tick_count_fsuc</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;tick_count r c (f (Suc n)) = tick_count r c (f n) + card {k. k = f (Suc n) &#8743; hamlet ((Rep_run r) k c)}&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class="string">&quot;&#8704;k. n &lt; k &#8743; k &lt; (Suc n) &#10230; &#172;hamlet ((Rep_run r) k c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class="string">&quot;finite {k. k &#8804; f n &#8743; hamlet ((Rep_run r) k c)}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class="string">&quot;finite {k. f n &lt; k &#8743; k &#8804; f (Suc n) &#8743; hamlet ((Rep_run r) k c)}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class="string">&quot;{k. k &#8804; f n &#8743; hamlet ((Rep_run r) k c)} &#8745; {k. f n &lt; k &#8743; k &#8804; f (Suc n) &#8743; hamlet ((Rep_run r) k c)} = {}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;strict_mono f&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="">m</span><span class="delimiter">:</span><span class="string">&quot;f n &lt; f (Suc n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">strict_monoD</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="">m&#39;</span><span class="delimiter">:</span><span class="string">&quot;f n &#8804; f (Suc n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">4</span><span class="delimiter">:</span><span class="string">&quot;{k. k &#8804; f (Suc n) &#8743; hamlet ((Rep_run r) k c)}
          = {k. k &#8804; f n &#8743; hamlet ((Rep_run r) k c)} &#8746; {k. f n &lt; k &#8743; k &#8804; f (Suc n) &#8743; hamlet ((Rep_run r) k c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">nat_interval_union</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">m&#39;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">5</span><span class="delimiter">:</span><span class="string">&quot;&#8704;k. (f n) &lt; k &#8743; k &lt; f (Suc n) &#10230; &#172;hamlet ((Rep_run r) k c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">*</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_le_eq</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">leD</span><span class=""> </span><span class="">strict_mono_less</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count r c (f (Suc n)) = card {k. k &#8804; f (Suc n) &#8743; hamlet ((Rep_run r) k c)}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_def</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = card {k. k &#8804; f n &#8743; hamlet ((Rep_run r) k c)}
                 + card {k. f n &lt; k &#8743; k &#8804; f (Suc n) &#8743; hamlet ((Rep_run r) k c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">card_Un_disjoint</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="">3</span><span class="delimiter">]</span><span class=""> </span><span class="">4</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">presburger</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = tick_count r c (f n)
                + card {k. f n &lt; k &#8743; k &#8804; f (Suc n) &#8743; hamlet ((Rep_run r) k c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class=""> </span><span class="string">&quot;f n&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = tick_count r c (f n)
                  + card {k. k = f (Suc n) &#8743; hamlet ((Rep_run r) k c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">5</span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">order_le_less</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">finally</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">card_sing_prop</span><span class="delimiter">:</span><span class="string">&quot;card {i. i = n &#8743; P i} = (if P n then 1 else 0)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">card_empty</span><span class=""> </span><span class="">empty_Collect_eq</span><span class=""> </span><span class="">is_singletonI&#39;</span><span class=""> </span><span class="">is_singleton_altdef</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">corollary</span></span><span class=""> </span><span class="">tick_count_f_suc</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;tick_count r c (f (Suc n)) = tick_count r c (f n) + (if hamlet ((Rep_run r) (f (Suc n)) c) then 1 else 0)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_fsuc</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="">card_sing_prop</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;f (Suc n)&quot;</span><span class=""> </span><span class="string">&quot;&#955;k. hamlet ((Rep_run r) k c)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">corollary</span></span><span class=""> </span><span class="">tick_count_f_suc_suc</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;tick_count r c (f (Suc n)) = (if hamlet ((Rep_run r) (f (Suc n)) c)
                                       then Suc (tick_count r c (f n))
                                       else tick_count r c (f n))&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_f_suc</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tick_count_f_suc_sub</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;tick_count r c (f (Suc n)) = (if hamlet ((Rep_run sub) (Suc n) c)
                                         then Suc (tick_count r c (f n))
                                         else tick_count r c (f n))&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_f_suc_suc</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tick_count_sub</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;tick_count sub c n = tick_count r c (f n)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count sub c n = card {i. i &#8804; n &#8743; hamlet ((Rep_run sub) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;sub&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class=""> </span><span class="string">&quot;n&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = card (image f {i. i &#8804; n &#8743; hamlet ((Rep_run sub) i c)})&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_injects</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">card_image</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = card {i. i &#8804; f n &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">dilated_prefix</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">,</span><span class=""> </span><span class="">symmetric</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="string">&quot;n&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = tick_count r c (f n)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class=""> </span><span class="string">&quot;f n&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">finally</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">corollary</span></span><span class=""> </span><span class="">run_tick_count_sub</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;run_tick_count sub c n = run_tick_count r c (f n)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="">tick_count_is_fun</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dil_tick_count</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;sub &#8810; r&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="string">&quot;&#8704;n. run_tick_count sub a n &#8804; run_tick_count sub b n&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;run_tick_count r a n &#8804; run_tick_count r b n&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">is_subrun_def</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">f</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class="string">&quot;dilating f sub r&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induction</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count sub a 0 &#8804; tick_count sub b 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_is_fun</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class="string">&quot;tick_count r a (f 0) &#8804; tick_count r b (f 0)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">*</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">*</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;0 &#8804; f 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;tick_count r a 0 &#8804; tick_count r b 0&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">consider</span></span><span class=""> </span><span class="delimiter">(</span><span class="">a</span><span class="delimiter">)</span><span class=""> </span><span class="string">&quot;0 &lt; f 0&quot;</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="delimiter">(</span><span class="">b</span><span class="delimiter">)</span><span class=""> </span><span class="string">&quot;0 = f 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">a</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">empty_dilated_prefix</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="string">&quot;0&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Collect_empty_eq</span><span class=""> </span><span class="">card.empty</span><span class=""> </span><span class="">le_zero_eq</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">b</span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">tick_count_is_fun</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count sub a (Suc n) &#8804; tick_count sub b (Suc n)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_is_fun</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class="string">&quot;tick_count r a (f (Suc n)) &#8804; tick_count r b (f (Suc n))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">*</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">tick_count_f_suc_sub</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">*</span><span class="delimiter">]</span><span class=""> </span><span class="">Suc.IH</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">is_subrun_def</span><span class=""> </span><span class="">run_tick_count_sub</span><span class=""> </span><span class="">run_tick_count_suc</span><span class=""> </span><span class="">ticks_imp_ticks_subk</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tick_count_strict_0</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;tick_count_strict r c (f 0) = 0&quot;</span><span class="">
</span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Collect_empty_eq</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">card.empty</span><span class=""> </span><span class="">empty_dilated_prefix</span><span class=""> </span><span class="">tick_count_strict_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">no_tick_before_suc</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="string">&quot;(f n) &lt; k &#8743; k &lt; (f (Suc n))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;&#172;hamlet ((Rep_run r) k c)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="">strict_mono_less</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tick_count_strict_stable</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;(f n) &lt; k &#8743; k &lt; (f (Suc n))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;tick_count_strict r c k = tick_count_strict r c (f (Suc n))&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count_strict r c k = card {i. i &lt; k &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_strict_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class=""> </span><span class="string">&quot;k&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(f n) &lt; k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">card_mnm</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;card {i. i &lt; k &#8743; hamlet ((Rep_run r) i c)}
   = card {i. i &#8804; (f n) &#8743; hamlet ((Rep_run r) i c)}
   + card {i. (f n) &lt; i &#8743; i &lt; k &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;k &lt; f (Suc n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">no_tick_before_suc</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class="">
</span><span class="">    </span><span class="string">&quot;card {i. (f n) &lt; i &#8743; i &lt; k &#8743; hamlet ((Rep_run r) i c)} = 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class="">
</span><span class="">    </span><span class="string">&quot;card {i. i &lt; k &#8743; hamlet ((Rep_run r) i c)}
   = card {i. i &#8804; (f n) &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> 
</span><span class="">    </span><span class="string">&quot;card {i. i &lt; k &#8743; hamlet ((Rep_run r) i c)}
   = card {i. i &lt; (f (Suc n)) &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">no_tick_before_suc</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">less_trans</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">order_le_less</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_strict_def</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="string">&quot;k&quot;</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                     </span><span class="">tick_count_strict_def</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="string">&quot;f (Suc n)&quot;</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tick_count_strict_sub</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;tick_count_strict sub c n = tick_count_strict r c (f n)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count_strict sub c n = card {i. i &lt; n &#8743; hamlet ((Rep_run sub) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_strict_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;sub&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class=""> </span><span class="string">&quot;n&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = card (image f {i. i &lt; n &#8743; hamlet ((Rep_run sub) i c)})&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_injects</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">card_image</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = card {i. i &lt; f n &#8743; hamlet ((Rep_run r) i c)}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">dilated_strict_prefix</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">assms</span><span class="delimiter">,</span><span class=""> </span><span class="">symmetric</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="string">&quot;n&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">also</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;... = tick_count_strict r c (f n)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">tick_count_strict_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;r&quot;</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class=""> </span><span class="string">&quot;f n&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">finally</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">card_prop_mono</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;m &#8804; n&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;card {i::nat. i &#8804; m &#8743; P i} &#8804; card {i. i &#8804; n &#8743; P i}&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;{i. i &#8804; m &#8743; P i} &#8838; {i. i &#8804; n &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;finite {i. i &#8804; n &#8743; P i}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">card_mono</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">mono_tick_count</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;mono (&#955; k. tick_count r c k)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class=""> </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class="delimiter">::</span><span class="">nat</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;x &#8804; y&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">card_prop_mono</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;tick_count r c x &#8804; tick_count r c y&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">tick_count_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="string">&quot;&#8896;x y. x &#8804; y &#10233; tick_count r c x &#8804; tick_count r c y&quot;</span><span class=""> </span><span class="keyword1"><span class="command">.</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">greatest_prev_image</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;(&#8708;n<span class="hidden">&#8681;</span><sub>0</sub>. f n<span class="hidden">&#8681;</span><sub>0</sub> = n) &#10233; (&#8707;n<span class="hidden">&#8681;</span><sub>p</sub>. f n<span class="hidden">&#8681;</span><sub>p</sub> &lt; n &#8743; (&#8704;k. f n<span class="hidden">&#8681;</span><sub>p</sub> &lt; k &#8743; k &#8804; n &#10230; (&#8708;k<span class="hidden">&#8681;</span><sub>0</sub>. f k<span class="hidden">&#8681;</span><sub>0</sub> = k)))&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induction</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f 0 = 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="string">&quot;0.prems&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#8707;n<span class="hidden">&#8681;</span><sub>0</sub>. f n<span class="hidden">&#8681;</span><sub>0</sub> = n&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">True</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">this</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">n<span class="hidden">&#8681;</span><sub>0</sub></span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;f n<span class="hidden">&#8681;</span><sub>0</sub> = n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;f n<span class="hidden">&#8681;</span><sub>0</sub> &lt; (Suc n) &#8743; (&#8704;k. f n<span class="hidden">&#8681;</span><sub>0</sub> &lt; k &#8743; k &#8804; (Suc n) &#10230; (&#8708;k<span class="hidden">&#8681;</span><sub>0</sub>. f k<span class="hidden">&#8681;</span><sub>0</sub> = k))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc.prems</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">le_antisym</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">False</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">Suc.IH</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">this</span><span class="delimiter">]</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">n<span class="hidden">&#8681;</span><sub>p</sub></span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;f n<span class="hidden">&#8681;</span><sub>p</sub> &lt; n &#8743; (&#8704;k. f n<span class="hidden">&#8681;</span><sub>p</sub> &lt; k &#8743; k &#8804; n &#10230; (&#8708;k<span class="hidden">&#8681;</span><sub>0</sub>. f k<span class="hidden">&#8681;</span><sub>0</sub> = k))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">Suc</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f n<span class="hidden">&#8681;</span><sub>p</sub> &lt; (Suc n) &#8743; (&#8704;k. f n<span class="hidden">&#8681;</span><sub>p</sub> &lt; k &#8743; k &#8804; (Suc n) &#10230; (&#8708;k<span class="hidden">&#8681;</span><sub>0</sub>. f k<span class="hidden">&#8681;</span><sub>0</sub> = k))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">le_SucE</span><span class=""> </span><span class="">less_Suc_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">strict_mono_suc</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;strict_mono f&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="string">&quot;f sn = Suc (f n)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;sn = Suc n&quot;</span><span class="">
</span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="">strict_mono_def</span><span class=""> </span><span class="">strict_mono_less</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tick_count_latest</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="string">&quot;f n<span class="hidden">&#8681;</span><sub>p</sub> &lt; n &#8743; (&#8704;k. f n<span class="hidden">&#8681;</span><sub>p</sub> &lt; k &#8743; k &#8804; n &#10230; (&#8708;k<span class="hidden">&#8681;</span><sub>0</sub>. f k<span class="hidden">&#8681;</span><sub>0</sub> = k))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;tick_count r c n = tick_count r c (f n<span class="hidden">&#8681;</span><sub>p</sub>)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Collect_cong</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">le_trans</span><span class=""> </span><span class="">not_le_imp_less</span><span class=""> </span><span class="">not_less_iff_gr_or_eq</span><span class=""> </span><span class="">tick_count_def</span><span class=""> </span><span class="">ticks_imp_ticks_subk</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">next_non_stuttering</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="string">&quot;dilating f sub r&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="string">&quot;f n<span class="hidden">&#8681;</span><sub>p</sub> &lt; n &#8743; (&#8704;k. f n<span class="hidden">&#8681;</span><sub>p</sub> &lt; k &#8743; k &#8804; n &#10230; (&#8708;k<span class="hidden">&#8681;</span><sub>0</sub>. f k<span class="hidden">&#8681;</span><sub>0</sub> = k))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="string">&quot;f sn<span class="hidden">&#8681;</span><sub>0</sub> = Suc n&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;sn<span class="hidden">&#8681;</span><sub>0</sub> = Suc n<span class="hidden">&#8681;</span><sub>p</sub>&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">smf</span><span class="delimiter">:</span><span class="string">&quot;strict_mono f&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dilating_def</span><span class=""> </span><span class="">dilating_fun_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f n<span class="hidden">&#8681;</span><sub>p</sub> &lt; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">smf</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class="string">&quot;sn<span class="hidden">&#8681;</span><sub>0</sub> &gt; n<span class="hidden">&#8681;</span><sub>p</sub>&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">strict_mono_less</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;f (Suc n<span class="hidden">&#8681;</span><sub>p</sub>) &gt; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">not_le_imp_less</span><span class=""> </span><span class="">smf</span><span class=""> </span><span class="">strict_mono_less</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;Suc n &#8804; f (Suc n<span class="hidden">&#8681;</span><sub>p</sub>)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;sn<span class="hidden">&#8681;</span><sub>0</sub> &#8804; Suc n<span class="hidden">&#8681;</span><sub>p</sub>&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">smf</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">strict_mono_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword2"><span class="keyword">end</span></span><span class="">
</span></pre>

</div>
</body>
</html>
